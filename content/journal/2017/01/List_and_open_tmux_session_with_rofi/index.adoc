=  List and open tmux session with rofi
:stylesheet: /assets/style.css

This article assume that you already know about rofi [1] and tmux [2].

In rofi you can list ssh client using command `rofi -show ssh`, and when
selecting one of it will create new terminal and start opening ssh connection
to selected server.
But what if we want to start or create new tmux session using predefined list
of session name like this one:

image::https://lh3.googleusercontent.com/-5q0xsFActkJJWTbhb0GpXBj3HYvbvsoWKiR9mO2NwJUCMFBgvOMNQwkb2Z59_4ysy386CcReLF-v3P61OFUxOjMLUGG8KVGUGzp0Vj6-g2t-eU2HVrsvVmJp50savI5UuTouBdbMqA5WWbVmuBKpRu5nKQQ20smFCdk6rhDzX0Q4abXjVvlQhLD6HwExGsAypbkldk8Aw6nuD6IGq0SEyrTA-tTe6EBKymRon3F22aCAxbsT-kKN9qdE76J-hlvSuTiCFyklDNwr8FMnJ6MStFpudUsc2xTpw0HbK4Twgu49WrKtpFZ8TRIQw4mZlYoFdbnusHdw1TUv4Vabvf4xQs4vAh1xmXOXSnuWuXMJQmI9vzEEoFsEhkjM63PBDExUPj7dXoNxLBPymBqPqd-bZw2-e-qk10H5nKKXOGUbWvBW_iIFbBQeR3XRyYmwDF0yG44Rw8CLXPkDfQ6vGJnQMN3DA543B4RMWPD6VaH56zTAXxP_xXyKKY3tY49do12x46FC5Lu_jzBlWgFXwcgoKKdA9Ckdxmj0NjDRPkBERcKG0xdCVEYcN-8ttRNgjaL4-wH7hJJlzmRyu29bVLqARhvpu-9_fY02C_Bizo-2-uYlG4j23t3RXrgUFECcx70pDpCVzTVrCgJIFVaNvWS1xEO65xmqbj5GPc7E27Ilwqc2DQF5byLzdCgrzeLz7K56TYA-f2ZRO6j62OEc_vhejU2gg=w800-h409-no[Rofi
sessions]

Lets start by creating a zsh script as module that can be executed by rofi.

First, create new file `~/bin/rofi-tmuxopen.sh`.

Create or modify rofi config, `~/.config/rofi/config`, by adding our custom
`tmuxopen`

----
! "Enabled modi" Set from: Default
rofi.modi: window,run,ssh,tmuxopen:~/bin/rofi-tmuxopen.sh
----

Next we start creating script.
Open the script file and create an associative array to map session name with
their working directory,

----
#!/usr/bin/env zsh

typeset -A session_map

session_map=(
  tesis    $HOME/tesis
  projectA $HOME/workspaces/projectA
)
----

We collect the key from our `session_map` to be displayed on rofi.

----
...
typeset -a session_name

for k v in "${(@kv)session_map}"; do
	session_names=($k $session_names)
done
----

The first time rofi execute our script, it will pass it with no parameter
`( $# -eq 0 )`, so what we will do is send the list of session name as an
input to be displayed by rofi.

----
...
if [[ $# -eq 0 ]]; then
	echo "$session_names" | tr ' ' '\n' | sort -n
	exit 0
fi
----

Each item must be separated by newline (`\n`), thats why we replace single
space with newline, and that is why your session name should not have space in
them.

When you select one of the item in list, rofi will execute the script again
with parameter, just like we call the script from terminal.
So, what we will do was,

*  catch the first parameter,
*  check if its exist in our session mapping,
*  and get their working directory.

----
...
SELECTED=$1
TMUXDIR=
FOUND=0

## - Check if user selection match with session mapping.
## - Get session working directory
for k v in "${(@kv)session_map}"; do
	if [[ "$k" == "$SELECTED" ]]; then
		TMUXDIR=$v
		FOUND=1
		break
	fi
done

if (( $FOUND == 0 )); then
	echo "Unknown session name $1"
	exit 1
fi
----

Last code was spawning new terminal to open new tmux session with working
directory set to `TMUXDIR`

----
$TERMINAL -e tmux new -c $TMUXDIR -As $SELECTED >/dev/null &
----

Thats it.


==  References

[1] https://davedavenport.github.io/rofi/

[2] https://tmux.github.io/
